!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();const t=document.getElementById("app");t&&(t.innerHTML='\n    <div class="three-body-app">\n      \x3c!-- 主内容区 - 3D视图占据100%视口 --\x3e\n      <main class="app-main">\n        \x3c!-- Three.js渲染容器 --\x3e\n        <div class="canvas-container">\n          <canvas id="three-canvas"></canvas>\n        </div>\n      </main>\n      \n      \x3c!-- 悬浮控制面板 --\x3e\n      <div class="floating-control-panel">\n        <div class="panel-header">\n          <h3>参数设置</h3>\n          <button id="close-panel-btn" class="close-panel-btn">×</button>\n        </div>\n        \n        \x3c!-- 时间步长控制 --\x3e\n        <div class="control-group">\n          <label for="timeStep">模拟速度</label>\n          <input type="range" id="timeStep" min="0.001" max="0.1" step="0.001" value="0.01">\n          <span id="timeStepValue">0.01</span>\n        </div>\n        \n        \x3c!-- 质量控制 --\x3e\n        <div class="control-group">\n          <label for="mass1">星体1质量</label>\n          <input type="range" id="mass1" min="1" max="10" step="0.1" value="1">\n          <span id="mass1Value">1</span>\n        </div>\n        \n        <div class="control-group">\n          <label for="mass2">星体2质量</label>\n          <input type="range" id="mass2" min="1" max="10" step="0.1" value="1">\n          <span id="mass2Value">1</span>\n        </div>\n        \n        <div class="control-group">\n          <label for="mass3">星体3质量</label>\n          <input type="range" id="mass3" min="1" max="10" step="0.1" value="1">\n          <span id="mass3Value">1</span>\n        </div>\n        \n        \x3c!-- 预设场景 --\x3e\n        <div class="control-group">\n          <label for="preset">预设场景</label>\n          <select id="preset">\n            <option value="default">默认配置</option>\n            <option value="figure8">8字轨道</option>\n            <option value="sunearthmoon">日地月</option>\n          </select>\n        </div>\n        \n        \x3c!-- 显示选项 --\x3e\n        <div class="control-group">\n          <label for="show-trails">显示轨迹:</label>\n          <input type="checkbox" id="show-trails" checked>\n        </div>\n        \n        \x3c!-- 应用按钮 --\x3e\n        <button id="applyBtn" class="apply-btn">应用设置</button>\n      </div>\n      \n      \x3c!-- 悬浮信息面板 --\x3e\n      <div class="floating-info-panel">\n        <div class="info-item">\n          <span class="info-label">状态:</span>\n          <span id="simulation-status" class="info-value">运行中</span>\n        </div>\n        <div class="info-item">\n          <span class="info-label">时间:</span>\n          <span id="simulationTime" class="info-value">00:00:00</span>\n        </div>\n      </div>\n      \n      \x3c!-- 右下角功能按钮组 --\x3e\n      <div class="core-actions">\n        <button id="preset-btn" class="floating-btn" title="预设场景">☰</button>\n        <button id="tutorial-btn" class="floating-btn" title="教程">?</button>\n        <button id="about-btn" class="floating-btn" title="关于">ℹ</button>\n        <button id="settings-btn" class="floating-btn" title="设置">⚙</button>\n      </div>\n      \n      \x3c!-- 左下角控制按钮组 --\x3e\n      <div class="simulation-controls">\n        <button id="play-btn" class="floating-btn" title="播放/暂停">⏸</button>\n        <button id="reset-btn" class="floating-btn" title="重置">↺</button>\n      </div>\n      \n      \x3c!-- FPS计数器 --\x3e\n      <div class="fps-counter" id="fps">0 FPS</div>\n    </div>\n  ');(new class{isPlaying=!0;simulationTime=0;fps=0;lastFrameTime=performance.now();simulationSpeed=1;showControlPanel=!1;isDraggingInfoPanel=!1;dragOffset={x:0,y:0};init(){this.bindSliderUpdates(),this.bindButtonEvents(),this.bindKeyboardShortcuts(),this.bindPanelDragging(),this.handleOutsideClick(),this.enhanceCameraControl(),this.startSimulationLoop(),this.toggleControlPanel(!1),setTimeout(()=>{this.showTooltip("欢迎使用三体问题模拟器！按ESC显示纯视图，按空格键暂停/播放，按R键重置")},1e3)}bindSliderUpdates(){["timeStep","mass1","mass2","mass3"].forEach(t=>{const e=document.getElementById(t),n=document.getElementById(`${t}Value`);e&&n&&e.addEventListener("input",()=>{n.textContent=parseFloat(e.value).toFixed("timeStep"===t?3:1)})})}bindButtonEvents(){const t=document.getElementById("applyBtn");t&&t.addEventListener("click",()=>this.updateSimulationParameters());const e=document.getElementById("close-panel-btn");e&&e.addEventListener("click",()=>this.toggleControlPanel(!1));const n=document.getElementById("preset-btn");n&&n.addEventListener("click",()=>this.showTooltip("预设场景功能开发中"));const i=document.getElementById("tutorial-btn");i&&i.addEventListener("click",()=>this.showTooltip("教程功能开发中"));const s=document.getElementById("about-btn");s&&s.addEventListener("click",()=>this.showTooltip("三体问题模拟器 v1.0"));const o=document.getElementById("settings-btn");o&&o.addEventListener("click",()=>this.toggleControlPanel(!0));const a=document.getElementById("play-btn");a&&a.addEventListener("click",()=>this.toggleSimulation());const l=document.getElementById("reset-btn");l&&l.addEventListener("click",()=>this.resetSimulation())}bindKeyboardShortcuts(){document.addEventListener("keydown",t=>{switch(t.key){case"Escape":this.toggleControlPanel(!1),this.showTooltip("纯视图模式");break;case" ":t.preventDefault(),this.toggleSimulation();break;case"r":case"R":this.resetSimulation()}})}bindPanelDragging(){const t=document.querySelector(".floating-info-panel");t&&(t.addEventListener("mousedown",e=>{this.isDraggingInfoPanel=!0,this.dragOffset.x=e.clientX-t.getBoundingClientRect().left,this.dragOffset.y=e.clientY-t.getBoundingClientRect().top,t.style.cursor="grabbing"}),document.addEventListener("mousemove",e=>{if(this.isDraggingInfoPanel&&t){const n=e.clientX-this.dragOffset.x,i=e.clientY-this.dragOffset.y,s=window.innerWidth-t.offsetWidth,o=window.innerHeight-t.offsetHeight;t.style.left=`${Math.max(0,Math.min(n,s))}px`,t.style.top=`${Math.max(0,Math.min(i,o))}px`}}),document.addEventListener("mouseup",()=>{this.isDraggingInfoPanel&&t&&(this.isDraggingInfoPanel=!1,t.style.cursor="move")}))}toggleControlPanel(t){const e=document.querySelector(".floating-control-panel");e&&(this.showControlPanel=void 0!==t?t:!this.showControlPanel,this.showControlPanel?e.classList.add("open"):e.classList.remove("open"))}toggleSimulation(){this.isPlaying=!this.isPlaying;const t=document.getElementById("play-btn"),e=document.getElementById("simulation-status");t&&(t.textContent=this.isPlaying?"⏸":"▶"),e&&(e.textContent=this.isPlaying?"运行中":"已暂停")}resetSimulation(){this.simulationTime=0;const t=document.getElementById("simulationTime");t&&(t.textContent="00:00:00"),this.showTooltip("模拟已重置")}updateSimulationParameters(){const t=document.getElementById("timeStep").value;document.getElementById("mass1").value,document.getElementById("mass2").value,document.getElementById("mass3").value,document.getElementById("preset").value,document.getElementById("show-trails").checked;this.simulationSpeed=100*parseFloat(t),this.showTooltip("参数已更新")}showTooltip(t){let e=document.querySelector(".tooltip");e&&e.remove(),e=document.createElement("div"),e.className="tooltip",e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e?.remove()},3e3)}startSimulationLoop(){const t=()=>{if(this.isPlaying){this.simulationTime+=.016*this.simulationSpeed;const t=Math.floor(this.simulationTime/3600),e=Math.floor(this.simulationTime%3600/60),n=Math.floor(this.simulationTime%60),i=document.getElementById("simulationTime");i&&(i.textContent=`${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`)}const e=performance.now(),n=(e-this.lastFrameTime)/1e3;this.fps=Math.round(1/n);const i=document.getElementById("fps");i&&(i.textContent=`${this.fps} FPS`),this.lastFrameTime=e,requestAnimationFrame(t)};t()}handleOutsideClick(){document.addEventListener("click",t=>{const e=document.querySelector(".floating-control-panel"),n=document.getElementById("settings-btn"),i=document.getElementById("close-panel-btn");e&&n&&i&&!e.contains(t.target)&&!n.contains(t.target)&&e.classList.contains("open")&&this.toggleControlPanel(!1)})}enhanceCameraControl(){const t=document.getElementById("three-canvas");t&&t.addEventListener("dblclick",()=>{this.showTooltip("视角已重置")})}}).init();

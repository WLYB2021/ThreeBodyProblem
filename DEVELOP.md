# 三体问题Web应用开发文档

## 开发计划

### 第一阶段：基础框架搭建（已完成）
- [x] 创建项目目录结构
- [x] 使用Vite初始化Vue 3 + TypeScript项目
- [x] 安装Three.js等核心依赖
- [x] 配置项目构建文件
- [x] 实现基础页面布局
- [x] 修改设计文档，使用黑白极简设计风格
- [x] 修改基础页面布局，使用黑白极简设计风格
- [x] 提交首个版本
- [x] 重构布局系统，移除固定导航栏和状态栏
- [x] 实现100%视口占据的中心3D视图区域
- [x] 开发悬浮式UI组件框架（视觉上悬浮，不可拖动）
- [x] 开发标题悬浮组件
- [x] 修复TypeScript类型错误
- [x] 修复CSS语法问题
- [x] 完成项目构建测试
- [x] 优化UI设计（黑色主界面，白色组件）
- [x] 修复悬浮组件超出视口边界问题
- [x] 调整左右下角悬浮组件位置，增加安全边距避免超出屏幕边界
- [x] 优化设计文档，明确悬浮组件布局规范、按钮间距要求（桌面端32px，移动端36px）和响应式策略
  - [x] 修复按钮重叠问题：将按钮从fixed定位改为relative定位，使其服从父容器flex布局
  - [x] 优化按钮布局：将设置按钮移至右上角独立显示，并实现控制面板打开时自动隐藏右下角按钮组的功能
  - [x] 优化按钮图标居中显示：调整.floating-btn样式，添加line-height:1、text-align:center、padding:0等属性确保特殊字符图标在按钮中完美居中
- [x] 修复设置按钮位置：将设置按钮从core-actions容器中移出，解决点击时短暂跳转到右下角的问题
- [x] 优化按钮显示逻辑：为设置按钮添加与核心功能按钮组相同的隐藏效果，确保弹窗弹出时也能平滑隐藏
- [x] 修复标题悬浮位移问题：重构.floating-title-panel样式，改用更可靠的left:0; right:0; margin:0 auto居中方式，完全移除过渡效果和transform属性，确保标题绝对居中靠上且鼠标悬浮时完全固定不位移

### 第二阶段：功能增强（已实现部分）
- [x] 实现三体物理计算模块
- [ ] 开发Three.js渲染组件
- [x] 实现悬浮控制面板组件（基础结构）
- [x] 实现悬浮操作按钮组（右下角核心功能，左下角控制按钮）（基础结构）
- [x] 实现悬浮信息面板组件（基础结构，支持拖动）
- [ ] 添加预设场景系统
- [x] 开发实时数据显示功能（FPS计数器）
- [x] 实现键盘快捷键支持（ESC、空格键、R键）

### 第三阶段：优化与完善
- [ ] 性能优化（物理计算、渲染）
- [ ] 响应式设计完善，适配移动端
- [x] 添加动效与交互增强（按钮动画、面板滑入效果）
- [x] 为UI组件添加进入动画：从中心向外移动效果
  - [x] 实现组件按顺序依次出现的序列效果，提升用户体验
  - [x] 动画包含透明度变化、缩放效果和微小的回弹效果
  - [x] 修复动画导致组件位置漂移的问题：移除动画中的translate(-50%, -50%)
  - [x] 修复设置按钮隐藏逻辑：确保控制面板打开时设置按钮能够正确隐藏
- [x] 实现面板拖动功能（信息面板可拖动）
- [x] 优化摄像机控制（添加双击重置视角）
- [x] 添加FPS计数器和临时提示信息
- [ ] 单元测试与集成测试
- [x] 文档完善

## 当前进度
| 任务 | 状态 | 负责人 | 完成日期 |
|------|------|--------|----------|
| 项目初始化 | 完成 | - | - |
| 依赖安装 | 完成 | - | - |
| 悬浮式布局系统 | 完成 | - | - |
| 交互系统基础框架 | 完成 | - | - |
| 代码优化与修复 | 完成 | - | - |
| 项目构建测试 | 完成 | - | - |
| 物理模拟 | 进行中 | - | - |

## 项目概述
三体问题Web应用是一个基于WebGL的交互式三体系统模拟器，旨在通过直观的可视化方式展示三体系统的动态行为和混沌特性。本项目采用开源教育工具定位，面向对物理学、天文学感兴趣的学生、教育工作者和科普爱好者。采用了全新的悬浮式布局设计，提供沉浸式视觉体验，同时保持直观的交互方式。

## 技术栈选择
- **前端框架**：Vue 3 + TypeScript
- **构建工具**：Vite
- **3D渲染**：Three.js + WebGL 1.0
- **样式**：原生CSS
- **数据存储**：LocalStorage
- **物理计算**：自定义物理引擎（RK4数值积分）

## 项目结构
```
src/
├── assets/           # 静态资源
├── components/       # Vue组件
│   ├── ThreeCanvas.vue     # Three.js渲染组件
│   ├── FloatingControlPanel.vue    # 悬浮控制面板组件
│   ├── FloatingActionButtons.vue   # 悬浮操作按钮组
│   ├── FloatingInfoPanel.vue       # 悬浮信息面板组件
│   └── PresetSelector.vue          # 预设场景选择器
├── hooks/            # Vue组合式函数
│   ├── useThree.ts         # Three.js初始化钩子
│   ├── usePhysics.ts       # 物理计算钩子
│   ├── useKeyboardShortcuts.ts     # 键盘快捷键钩子
│   └── useFloatingComponents.ts    # 悬浮组件管理钩子
├── physics/          # 物理计算模块
│   ├── calculations.ts     # 基础物理计算
│   ├── integrators.ts      # 数值积分器
│   └── constants.ts        # 物理常数
├── utils/            # 工具函数
│   ├── animationUtils.ts   # 动画工具函数
│   └── dragUtils.ts        # 拖动功能工具函数
├── App.vue           # 根组件
├── main.ts           # 入口文件
└── style.css         # 全局样式
```

## 开发规范
- 代码遵循Vue 3 Composition API风格
- 命名规范：组件使用PascalCase，变量使用camelCase，常量使用SNAKE_CASE
- 每个组件需要添加TypeScript接口定义
- 关键算法需要添加注释说明
- 遵循ESLint和Prettier规范
- 悬浮组件设计需考虑可访问性，确保键盘可操作
- 所有交互元素需添加适当的ARIA属性
- 动画效果需设置适当的持续时间和缓动函数

## 已实现功能说明

### 1. 悬浮式布局系统
- 移除固定导航栏和状态栏，实现100%视口中心3D视图
- 所有UI元素采用悬浮式设计，使用绝对定位和z-index控制层级
- 实现半透明黑色背景，提升沉浸感
- 应用容器使用relative定位，作为所有悬浮元素的参考点

### 2. 交互组件实现
- **悬浮控制面板**：从右侧滑入，包含参数设置、预设选择等基础结构
- **悬浮信息面板**：显示状态和时间，支持鼠标拖动定位
- **悬浮按钮组**：右下角核心功能按钮组和左下角控制按钮组
- **FPS计数器**：右上角显示实时帧率
- **提示信息**：顶部临时显示操作反馈

### 3. 交互体验优化
- **键盘快捷键**：
  - ESC键：隐藏所有面板，显示纯视图
  - 空格键：切换播放/暂停状态
  - R键：重置模拟
- **摄像机控制增强**：双击canvas重置视角
- **沉浸体验改进**：点击外部区域自动收起控制面板，默认进入纯视图模式

### 4. 动态效果实现
- 按钮点击放大动画反馈
- 面板滑入滑出平滑过渡
- 信息面板可拖动和定位
- 鼠标悬停效果增强交互性

## 注意事项
- 物理计算需要注意数值精度问题
- 渲染性能需要重点优化
- 确保在低性能设备上也能流畅运行
- 遵循响应式设计原则，适配不同屏幕尺寸
- 下一阶段重点：实现Three.js场景渲染和物理模拟，完成参数控制与模拟效果的联动